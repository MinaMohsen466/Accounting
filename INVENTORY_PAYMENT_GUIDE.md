# 📦 دليل تسجيل دفع المشتريات في المخزون

## 🎯 المشكلة التي تم حلها

### المشكلة السابقة ❌
عند إضافة منتج جديد للمخزون:
- ✅ تزيد الكمية في المخزون
- ❌ **لا يتم خصم قيمة الشراء من البنك/الخزينة**
- ❌ **لا يظهر المبلغ في صفحة "الخزينة والبنوك"**
- ❌ **لا يُسجل قيد محاسبي**

**النتيجة**: المخزون يزيد ولكن الحسابات المالية لا تتأثر!

---

## ✅ الحل الجديد

الآن عند إضافة منتج جديد للمخزون، لديك **خياران**:

### الخيار 1: إضافة المنتج فقط (الطريقة القديمة)
- يضيف المنتج للمخزون
- **لا يؤثر على الرصيد المالي**
- مناسب للجرد الأولي أو نقل البضاعة

### الخيار 2: إضافة المنتج + تسجيل الدفع ⭐ (الميزة الجديدة)
✅ **تسجيل دفع الشراء (خصم من البنك/الخزينة)**
- يضيف المنتج للمخزون
- **يخصم قيمة الشراء من الحساب المختار**
- يسجل قيد محاسبي تلقائياً:
  - مدين: المخزون (1301)
  - دائن: البنك/الخزينة المختار
- يظهر التحديث فوراً في "الخزينة والبنوك" 🏦

---

## 📱 كيفية الاستخدام

### خطوات إضافة منتج مع تسجيل الدفع:

1. **افتح صفحة المخزون** 📦
2. **اضغط "إضافة منتج جديد"** ➕
3. **املأ بيانات المنتج:**
   - الاسم
   - رقم المنتج (SKU)
   - التصنيف
   - الوحدة
   - **الكمية** (مثلاً: 10)
   - سعر البيع (مثلاً: 30 د.ك)
   - **سعر الشراء** (مثلاً: 20 د.ك)
   - الحد الأدنى للمخزون
   - إلخ...

4. **في نهاية النموذج، ستجد قسم جديد:**

   ```
   ┌────────────────────────────────────────────────┐
   │ ☑️ تسجيل دفع الشراء (خصم من البنك/الخزينة) 💰 │
   │                                                │
   │ سيتم خصم قيمة الشراء من الحساب المختار       │
   │ وإنشاء قيد محاسبي تلقائياً                    │
   │                                                │
   │ 📋 اختر حساب الدفع: *                         │
   │    [▼ -- اختر حساب الدفع --]                  │
   │        • الخزينة النقدية (1001)              │
   │        • البنك الوطني (1002)                  │
   │        • بنك الخليج (1003)                    │
   │                                                │
   │ ┌──────────────────────────────────────────┐  │
   │ │ إجمالي قيمة الشراء: 200.000 د.ك         │  │
   │ │ (20 د.ك × 10 قطعة)                      │  │
   │ └──────────────────────────────────────────┘  │
   └────────────────────────────────────────────────┘
   ```

5. **فعّل الخيار** ✅ **تسجيل دفع الشراء**
6. **اختر الحساب** (مثلاً: الخزينة النقدية)
7. **سيظهر إجمالي قيمة الشراء تلقائياً**
8. **اضغط "حفظ"** ✅

---

## 📊 النتيجة في النظام

### مثال: شراء 10 علب دهان بـ 20 د.ك للعلبة (إجمالي 200 د.ك)

#### 1️⃣ **في المخزون:**
```
المنتج: دهان أبيض
الكمية: +10 علبة
سعر الشراء: 20 د.ك
سعر البيع: 30 د.ك
```

#### 2️⃣ **في القيود اليومية:**
```
التاريخ: اليوم
الوصف: شراء دهان أبيض (10 piece)

مدين: المخزون (1301)              200.000 د.ك
دائن: الخزينة النقدية (1001)      200.000 د.ك
```

#### 3️⃣ **في الخزينة والبنوك:**
```
الخزينة النقدية: -200 د.ك ⬇️
الرصيد الإجمالي: -200 د.ك ⬇️
```

**ملاحظة مهمة:** ✨
- إذا كان رصيد الخزينة **0 د.ك**، بعد الشراء سيصبح **-200 د.ك**
- هذا صحيح محاسبياً! ✅
- الرصيد السالب يعني **مديونية عليك** (دين)
- يجب إضافة رأس مال أو تحصيل مبيعات لتصفية المديونية

---

## 🎯 متى تستخدم كل خيار؟

| الموقف | الخيار المناسب |
|--------|----------------|
| شراء منتج من مورد ودفع نقداً | ✅ تسجيل دفع الشراء |
| شراء منتج بشيك أو تحويل بنكي | ✅ تسجيل دفع الشراء |
| جرد أولي (عد المخزون الحالي) | ❌ إضافة فقط (بدون دفع) |
| نقل بضاعة من فرع لآخر | ❌ إضافة فقط (بدون دفع) |
| شراء بالآجل (سيُدفع لاحقاً) | ❌ إضافة فقط، ثم سجل الدفع لاحقاً |

---

## 🔄 مثال عملي كامل

### السيناريو: محل دهانات يفتح لأول مرة

#### الخطوة 1: إضافة رأس المال
1. اذهب إلى 🏦 **الخزينة والبنوك**
2. اضغط على **الخزينة النقدية**
3. اضغط **"إيداع"**
4. المبلغ: **1000 د.ك**
5. الوصف: "رأس المال الأولي"
6. حفظ ✅

**النتيجة:** رصيد الخزينة = **1000 د.ك** 💰

---

#### الخطوة 2: شراء منتجات للمخزون
**المشتريات:**
- 20 علبة دهان داخلي @ 15 د.ك = **300 د.ك**
- 10 علب دهان خارجي @ 25 د.ك = **250 د.ك**
- 50 فرشاة @ 2 د.ك = **100 د.ك**
- **الإجمالي: 650 د.ك**

**الخطوات:**

##### منتج 1: دهان داخلي
1. اذهب إلى 📦 **المخزون**
2. اضغط **"إضافة منتج جديد"**
3. املأ البيانات:
   - الاسم: دهان داخلي أبيض
   - SKU: INT-WHT-001
   - الكمية: 20
   - سعر الشراء: 15
   - سعر البيع: 25
4. ✅ فعّل **"تسجيل دفع الشراء"**
5. اختر: **الخزينة النقدية**
6. سيظهر: **إجمالي قيمة الشراء: 300.000 د.ك**
7. حفظ ✅

**النتيجة:**
- رصيد الخزينة: **1000 - 300 = 700 د.ك** ✅

##### منتج 2: دهان خارجي
1. نفس الخطوات
2. الكمية: 10
3. سعر الشراء: 25
4. إجمالي: **250 د.ك**

**النتيجة:**
- رصيد الخزينة: **700 - 250 = 450 د.ك** ✅

##### منتج 3: فرش
1. نفس الخطوات
2. الكمية: 50
3. سعر الشراء: 2
4. إجمالي: **100 د.ك**

**النتيجة:**
- رصيد الخزينة: **450 - 100 = 350 د.ك** ✅

---

#### الخطوة 3: التحقق

**في 🏦 الخزينة والبنوك:**
```
رصيد الخزينة النقدية: 350.000 د.ك
الرصيد الإجمالي: 350.000 د.ك
```

**في 📦 المخزون:**
```
دهان داخلي: 20 علبة
دهان خارجي: 10 علب
فرش: 50 قطعة
```

**في القيود اليومية:**
```
✅ إيداع رأس المال: 1000 د.ك
✅ شراء دهان داخلي: -300 د.ك
✅ شراء دهان خارجي: -250 د.ك
✅ شراء فرش: -100 د.ك
─────────────────────────────
الرصيد النهائي: 350 د.ك
```

---

## 💡 ماذا لو كان الرصيد صفر؟

### السيناريو: محل جديد بدون رأس مال

إذا أضفت منتجات بدون إيداع رأس مال:

**البداية:**
- رصيد الخزينة: **0 د.ك**

**بعد شراء منتجات بـ 500 د.ك:**
- رصيد الخزينة: **-500 د.ك** 🔴

**التفسير:**
- الرصيد السالب = **مديونية عليك** (دين)
- يعني أنك اشتريت بضاعة ولم تدفع بعد
- أو أنك استلفت المبلغ

**الحل:**
1. أضف رأس مال (إيداع)
2. أو بع منتجات وحصّل المبلغ
3. الرصيد سيصبح موجباً تدريجياً

---

## ⚠️ ملاحظات مهمة

### 1️⃣ **الخيار يظهر فقط للمنتجات الجديدة**
- عند **إضافة منتج جديد** ✅
- عند **تعديل منتج موجود** ❌ (الخيار لا يظهر)

### 2️⃣ **حساب الدفع إجباري**
- يجب اختيار حساب بنك/خزينة
- تظهر فقط الحسابات المناسبة:
  - حسابات البنوك
  - حسابات الخزينة
  - أي حساب كوده يبدأ بـ 100

### 3️⃣ **إجمالي قيمة الشراء يُحسب تلقائياً**
```
الإجمالي = سعر الشراء × الكمية
```

### 4️⃣ **حساب المخزون (1301)**
- يُنشأ تلقائياً إذا لم يكن موجوداً
- نوع الحساب: أصول (Asset)
- يمكن رؤيته في شجرة الحسابات

---

## 🔍 للتحقق من عمل الميزة

بعد إضافة منتج بتسجيل الدفع:

### 1️⃣ تحقق من المخزون
- اذهب إلى 📦 **المخزون**
- تأكد من وجود المنتج
- تحقق من الكمية

### 2️⃣ تحقق من الرصيد
- اذهب إلى 🏦 **الخزينة والبنوك**
- تحقق من رصيد الحساب المختار
- **يجب أن ينقص بقيمة الشراء**

### 3️⃣ تحقق من القيد المحاسبي
- اذهب إلى 📒 **القيود اليومية**
- ابحث عن قيد "شراء [اسم المنتج]"
- تحقق من:
  - مدين: المخزون (1301)
  - دائن: البنك/الخزينة
  - المبلغ صحيح

### 4️⃣ تحقق من المعاملات
- اذهب إلى 🏦 **الخزينة والبنوك**
- اضغط على الحساب المختار
- يجب أن ترى معاملة الشراء في القائمة

---

## 🆚 مقارنة الطريقتين

| الميزة | بدون تسجيل الدفع | مع تسجيل الدفع ⭐ |
|--------|------------------|-------------------|
| إضافة للمخزون | ✅ | ✅ |
| خصم من البنك/الخزينة | ❌ | ✅ |
| قيد محاسبي | ❌ | ✅ |
| يظهر في رصيد البنوك | ❌ | ✅ |
| مناسب للجرد | ✅ | ❌ |
| مناسب للشراء الفعلي | ❌ | ✅ |

---

## 📚 روابط ذات صلة

- **صفحة المخزون**: `http://localhost:5174` → القائمة → 📦 المخزون
- **صفحة الخزينة والبنوك**: `http://localhost:5174` → القائمة → 🏦 الخزينة والبنوك
- **صفحة القيود اليومية**: `http://localhost:5174` → القائمة → 📒 القيود اليومية
- **دليل نظام البنوك**: `BANKING_USAGE_GUIDE.md`
- **دليل الدفع الفوري في الفواتير**: `PAYMENT_FEATURE_GUIDE.md`

---

## ✅ الخلاصة

### 🔸 للجرد الأولي أو العد:
```
إضافة منتج → بدون تسجيل الدفع
(فقط لتسجيل ما هو موجود بالفعل)
```

### 🔸 للشراء الفعلي:
```
إضافة منتج → ✅ تسجيل دفع الشراء → اختر الحساب
(يخصم من البنك/الخزينة فوراً)
```

### 🔸 للرصيد السالب:
```
الرصيد السالب = مديونية عليك
الحل: أضف رأس مال أو حصّل مبيعات
```

---

**النصيحة الذهبية:** 💡
- استخدم **تسجيل الدفع** عند الشراء الفعلي من الموردين
- استخدم **بدون دفع** للجرد الأولي فقط
- تابع رصيدك دائماً في صفحة "الخزينة والبنوك"
- الرصيد السالب مسموح ويعني أنك مدين

---

**تم التطوير بواسطة:** GitHub Copilot  
**تاريخ التحديث:** 25 أكتوبر 2025  
**الإصدار:** 2.1.0

# 💰 دليل استخدام ميزة الدفع الفوري في الفواتير

## 📝 نظرة عامة

تم إضافة ميزة جديدة مهمة إلى نظام الفواتير تتيح لك **تسجيل الدفع فوراً** عند إنشاء الفاتورة، مما يضيف المبلغ مباشرة إلى حساب البنك أو الخزينة.

---

## 🔧 المشكلة السابقة

في السابق، عند إنشاء فاتورة مبيعات:
- ✅ يتم إنشاء القيد اليومي (ربط العميل بالمبيعات)
- ❌ **لا يتم إضافة المبلغ للبنك أو الخزينة**
- 📊 الرصيد في "الخزينة والبنوك" لا يتغير

**السبب**: القيد اليومي يسجل فقط أن العميل مدين بالمبلغ (ذمم مدينة)، ولكن المبلغ لا يدخل للبنك إلا عند التحصيل الفعلي.

---

## ✅ الحل الجديد

الآن عند إنشاء فاتورة جديدة، لديك **خياران**:

### الخيار 1: القيد اليومي فقط (الطريقة التقليدية)
✔️ **إنشاء قيد محاسبي تلقائي**
- يسجل أن العميل مدين بالمبلغ
- المبلغ يظهر في "كشف حساب العميل"
- **لا يؤثر على رصيد البنك/الخزينة**

### الخيار 2: الدفع الفوري (الميزة الجديدة)
✔️ **إنشاء قيد محاسبي تلقائي**  
✔️ **تسجيل الدفع فوراً (إضافة للبنك/الخزينة)** ⭐ جديد

عند تفعيل هذا الخيار:
1. تختار حساب البنك أو الخزينة
2. يتم تسجيل الدفع تلقائياً
3. **يضاف المبلغ مباشرة للحساب المختار**
4. يظهر التحديث فوراً في صفحة "الخزينة والبنوك" 🏦

---

## 📱 كيفية الاستخدام

### خطوات إنشاء فاتورة بدفع فوري:

1. **افتح صفحة الفواتير** 📄
2. **اضغط "إضافة فاتورة جديدة"** ➕
3. **املأ بيانات الفاتورة** (العميل، المنتجات، إلخ)
4. **في نهاية النموذج**، ستجد:
   
   ```
   ☑️ إنشاء قيد محاسبي تلقائي
   
   ☑️ تسجيل الدفع فوراً (إضافة للبنك/الخزينة) 🟢
       ↓
   📋 اختر حساب البنك/الخزينة:
       [▼ -- اختر حساب البنك/الخزينة --]
           • الخزينة النقدية (1001)
           • البنك الوطني (1002)
           • بنك الخليج (1003)
   ```

5. **فعّل الخيار الثاني** وحدد الحساب (مثلاً: الخزينة النقدية)
6. **اضغط "إنشاء الفاتورة"** ✅

### النتيجة:
- ✅ يتم إنشاء الفاتورة
- ✅ يتم خصم/إضافة المخزون
- ✅ يتم إنشاء القيد اليومي (ربط العميل بالمبيعات)
- ✅ **يتم تسجيل قيد دفع إضافي** (مدين: البنك، دائن: العميل)
- ✅ **يظهر المبلغ في رصيد البنك/الخزينة فوراً** 💰

---

## 🎯 متى تستخدم كل خيار؟

| الموقف | الخيار المناسب |
|--------|----------------|
| العميل دفع نقداً عند التسليم | ✅ دفع فوري |
| العميل دفع بالبطاقة الآن | ✅ دفع فوري |
| البيع بالآجل (سيدفع لاحقاً) | ❌ قيد محاسبي فقط |
| تحصيل الدفعة لاحقاً | ❌ قيد محاسبي فقط |

---

## 🔄 مثال عملي كامل

### السيناريو: بيع دهان بـ 150 د.ك نقداً

**الخطوات:**
1. أنشئ فاتورة مبيعات
2. العميل: أحمد محمد
3. المنتج: دهان أبيض، الكمية: 5، السعر: 30 د.ك
4. الإجمالي: **150 د.ك**
5. فعّل: ✅ **إنشاء قيد محاسبي تلقائي**
6. فعّل: ✅ **تسجيل الدفع فوراً**
7. اختر: **الخزينة النقدية (1001)**
8. اضغط "إنشاء الفاتورة"

**النتيجة في النظام:**

📊 **في القيود اليومية** (2 قيود):

**القيد 1 - قيد الفاتورة:**
```
مدين: حساب أحمد محمد (1101-xxx)    150 د.ك
دائن: المبيعات (4001)                150 د.ك
```

**القيد 2 - قيد الدفع:**
```
مدين: الخزينة النقدية (1001)       150 د.ك
دائن: حساب أحمد محمد (1101-xxx)     150 د.ك
```

💰 **في الخزينة والبنوك:**
```
الخزينة النقدية: +150 د.ك ⬆️
الرصيد الإجمالي: +150 د.ك ⬆️
```

👤 **في حساب العميل (أحمد محمد):**
```
الرصيد النهائي: 0 د.ك (لأنه دفع فوراً)
```

---

## 🗑️ حذف جميع البيانات والبدء من جديد

إذا أردت البدء من الصفر:

1. **افتح صفحة حذف البيانات:**
   ```
   http://localhost:5174/clear-data.html
   ```

2. **ستظهر لك قائمة بجميع البيانات المخزنة**

3. **اضغط زر "مسح جميع البيانات"** 🗑️

4. **أكد الحذف مرتين** (للأمان)

5. **النتيجة:**
   - ✅ حذف جميع الحسابات
   - ✅ حذف جميع القيود اليومية
   - ✅ حذف جميع الفواتير
   - ✅ حذف جميع العملاء والموردين
   - ✅ حذف جميع أصناف المخزون
   - ✅ حذف بيانات المستخدم الحالي

6. **ارجع للتطبيق:**
   ```
   http://localhost:5174
   ```

7. **سجل دخول مجدداً:**
   - اسم المستخدم: `admin`
   - كلمة المرور: `admin123`

8. **البيانات الافتراضية ستُنشأ تلقائياً:**
   - ✅ شجرة الحسابات الكاملة
   - ✅ حسابات البنوك (الخزينة، البنك الوطني، بنك الخليج)
   - ✅ حسابات المصروفات (الرواتب، الإيجار، إلخ)

---

## 🎓 ملاحظات مهمة

### ⚠️ تنبيهات:

1. **خيار الدفع الفوري يظهر فقط للفواتير الجديدة**
   - لا يمكن تعديل فاتورة قديمة وإضافة دفع فوري
   - لتسجيل دفع لفاتورة قديمة، استخدم صفحة "الخزينة والبنوك" 🏦

2. **يجب اختيار حساب بنك/خزينة**
   - الحقل إجباري عند تفعيل "تسجيل الدفع فوراً"
   - تظهر فقط الحسابات من نوع "بنك" أو "خزينة"

3. **الدفع الفوري يناسب:**
   - ✅ المبيعات النقدية
   - ✅ الدفع الإلكتروني الفوري
   - ✅ الدفع بالبطاقة
   - ❌ **لا يناسب** البيع بالآجل

### 🔍 للتحقق من عمل الميزة:

بعد إنشاء فاتورة بدفع فوري:

1. **اذهب إلى 🏦 الخزينة والبنوك**
2. **تحقق من رصيد الحساب المختار** (يجب أن يزيد)
3. **اضغط على الحساب لرؤية المعاملات الأخيرة**
4. **يجب أن تجد معاملة الدفع مسجلة**

---

## 📚 روابط مفيدة

- **صفحة الفواتير**: `http://localhost:5174` → القائمة → 📄 الفواتير
- **صفحة الخزينة والبنوك**: `http://localhost:5174` → القائمة → 🏦 الخزينة والبنوك
- **صفحة حذف البيانات**: `http://localhost:5174/clear-data.html`
- **دليل نظام البنوك الكامل**: `BANKING_USAGE_GUIDE.md`

---

## ✅ الخلاصة

الآن لديك طريقتان لتسجيل المبيعات:

### 🔹 الطريقة التقليدية (بدون دفع فوري):
```
فاتورة → قيد محاسبي → العميل مدين
(المبلغ في ذمة العميل، لم يُدفع بعد)
```

### 🔹 الطريقة الجديدة (بدفع فوري):
```
فاتورة → قيد محاسبي → قيد دفع → البنك/الخزينة
(المبلغ دُفع ومسجل في البنك/الخزينة فوراً)
```

**النصيحة الذهبية:** 💡
- استخدم **الدفع الفوري** للمبيعات النقدية
- استخدم **القيد المحاسبي فقط** للبيع بالآجل
- تحقق دائماً من رصيد البنك/الخزينة بعد العملية

---

**تم التطوير بواسطة:** GitHub Copilot  
**تاريخ التحديث:** 25 أكتوبر 2025  
**الإصدار:** 2.0.0

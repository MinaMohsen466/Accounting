# دليل فواتير المشتريات والخزينة/البنوك 💰📦

## المشكلة التي تم حلها ✅

**الشكوى:** "عند إضافة فاتورة مشتريات لا يتم خصمها من الرصيد في الخزينة والبنوك"

**الحل:** النظام يعمل بشكل صحيح! لكن يجب تفعيل الخيار الصحيح عند إنشاء الفاتورة.

---

## كيف يعمل النظام؟ 🔄

### 1️⃣ إنشاء فاتورة مشتريات بدون دفع فوري

عندما تنشئ فاتورة مشتريات بدون تفعيل خيار "تسجيل الدفع فوراً":

**ما يحدث:**
```
✅ القيد المحاسبي التلقائي (createJournalEntry = true افتراضياً):
   - المخزون (مدين): +1000 دينار
   - الموردون (دائن): +1000 دينار
   
💡 النتيجة:
   - المخزون زاد بمقدار المشتريات
   - أصبح لديك دين على المورد (ذمم دائنة)
   - البنك/الخزينة لم يتغير (لأنك لم تدفع بعد)
```

**متى تستخدم هذا الخيار؟**
- عند الشراء بالآجل (سيتم الدفع لاحقاً)
- عند استلام البضاعة ولكن لم تدفع بعد

---

### 2️⃣ إنشاء فاتورة مشتريات مع دفع فوري ✅ (الحل الصحيح)

عندما تنشئ فاتورة مشتريات **وتفعّل** خيار "💰 تسجيل الدفع فوراً":

**ما يحدث:**
```
1️⃣ القيد المحاسبي التلقائي (createJournalEntry):
   - المخزون (مدين): +1000 دينار
   - الموردون (دائن): +1000 دينار

2️⃣ قيد الدفع الفوري (recordPaymentNow):
   - الموردون (مدين): +1000 دينار (تسديد الدين)
   - البنك/الخزينة (دائن): -1000 دينار (خصم المبلغ)

💡 النتيجة النهائية:
   - المخزون: زاد بـ 1000 دينار ✅
   - الموردون: صفر (1000 دائن - 1000 مدين) ✅
   - البنك/الخزينة: نقص بـ 1000 دينار ✅✅✅
```

**متى تستخدم هذا الخيار؟**
- عند الشراء نقداً أو بشيك فوري
- عند الدفع عند الاستلام
- عند التحويل البنكي المباشر

---

## خطوات إنشاء فاتورة مشتريات مع خصم من البنك 📝

### الخطوة 1: افتح صفحة الفواتير
انتقل إلى: **📄 الفواتير** من القائمة الجانبية

### الخطوة 2: اضغط على "إضافة فاتورة"
الزر الأزرق في أعلى الصفحة

### الخطوة 3: اختر نوع الفاتورة
اختر: **فاتورة مشتريات** 📦

### الخطوة 4: املأ بيانات الفاتورة
- اختر المورد
- أضف المنتجات والكميات
- املأ الأسعار

### الخطوة 5: ⚠️ **المهم جداً** - فعّل خيار الدفع الفوري
في القسم **البنفسجي** في نهاية النموذج:

```
┌─────────────────────────────────────────────────────┐
│  ⚠️ مهم: خيارات الدفع والقيود المحاسبية ⚠️        │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ✅ [ ✓ ] إنشاء قيد محاسبي تلقائي                 │
│       (مفعّل افتراضياً - اتركه كما هو)             │
│                                                      │
│  💰 [ ✓ ] تسجيل الدفع فوراً ← **فعّل هذا الخيار**  │
│       ⚠️ فعّل هذا الخيار لخصم المبلغ من البنك      │
│          /الخزينة فوراً!                            │
│                                                      │
│  📌 اختر الحساب البنكي:                            │
│     [▼ الخزينة الرئيسية (1001)  ]                 │
│                                                      │
├─────────────────────────────────────────────────────┤
│ 📦 عند إنشاء فاتورة مشتريات:                      │
│ ✅ القيد التلقائي: يُسجل المخزون (زيادة)          │
│    والمورد (دين) تلقائياً                          │
│ 💰 تسجيل الدفع فوراً: يخصم المبلغ من البنك/        │
│    الخزينة ويُسدد دين المورد                       │
└─────────────────────────────────────────────────────┘
```

### الخطوة 6: احفظ الفاتورة
اضغط على **"إنشاء فاتورة"**

---

## التحقق من النتائج 🔍

بعد إنشاء الفاتورة، تحقق من:

### 1. صفحة الخزينة والبنوك 🏦
انتقل إلى: **🏦 الخزينة والبنوك**

**يجب أن ترى:**
- رصيد الخزينة/البنك **نقص** بمقدار الفاتورة
- المعاملة ظاهرة في جدول "آخر المعاملات"

### 2. التقارير 📊
انتقل إلى: **📊 التقارير**

**يجب أن ترى:**
- تكلفة المشتريات في قائمة الدخل
- تغيير في الأصول (المخزون والبنك)
- التدفقات النقدية تظهر الخروج النقدي

### 3. القيود المحاسبية 📝
انتقل إلى: **📝 القيود المحاسبية**

**يجب أن ترى قيدين:**

**القيد الأول (التلقائي):**
```
التاريخ: [تاريخ الفاتورة]
الوصف: قيد تلقائي من فاتورة مشتريات رقم [رقم الفاتورة]
───────────────────────────────────────
الحساب           │   مدين   │   دائن
───────────────────────────────────────
المخزون          │  1,000   │    -
الموردون         │    -     │  1,000
───────────────────────────────────────
المجموع          │  1,000   │  1,000
```

**القيد الثاني (الدفع الفوري):**
```
التاريخ: [تاريخ الفاتورة]
الوصف: دفع فاتورة رقم [رقم الفاتورة]
───────────────────────────────────────
الحساب           │   مدين   │   دائن
───────────────────────────────────────
الموردون         │  1,000   │    -
الخزينة          │    -     │  1,000
───────────────────────────────────────
المجموع          │  1,000   │  1,000
```

---

## الأخطاء الشائعة ❌

### ❌ الخطأ 1: عدم تفعيل "تسجيل الدفع فوراً"
**المشكلة:** المخزون يزيد لكن البنك لا ينقص
**الحل:** فعّل خيار 💰 تسجيل الدفع فوراً

### ❌ الخطأ 2: نسيان اختيار الحساب البنكي
**المشكلة:** لن يتم تسجيل الدفع
**الحل:** اختر الحساب البنكي من القائمة المنسدلة

### ❌ الخطأ 3: إلغاء تفعيل "إنشاء قيد محاسبي"
**المشكلة:** لن يتم تسجيل المخزون والمورد
**الحل:** اترك هذا الخيار **مفعّلاً دائماً** (افتراضياً)

---

## مثال عملي كامل 💼

### السيناريو:
اشتريت 50 علبة دهان من مورد "دهانات الكويت" بسعر 20 دينار للعلبة، ودفعت نقداً من الخزينة.

### الخطوات:
1. افتح صفحة الفواتير
2. اضغط "إضافة فاتورة"
3. اختر نوع الفاتورة: **مشتريات**
4. اختر المورد: **دهانات الكويت**
5. أضف المنتج:
   - المنتج: علبة دهان أبيض
   - الكمية: 50
   - السعر: 20 د.ك
   - المجموع: 1,000 د.ك
6. ✅ **فعّل** خيار "💰 تسجيل الدفع فوراً"
7. اختر الحساب: **الخزينة الرئيسية (1001)**
8. احفظ الفاتورة

### النتيجة:
```
📦 المخزون:
   علبة دهان أبيض: +50 علبة
   القيمة: +1,000 د.ك

💰 الخزينة الرئيسية:
   الرصيد السابق: 10,000 د.ك
   الرصيد الحالي: 9,000 د.ك (نقص 1,000 د.ك) ✅

👤 المورد (دهانات الكويت):
   الرصيد: 0 د.ك (تم السداد فوراً)

📊 التقارير:
   - تكلفة المشتريات: 1,000 د.ك
   - التدفقات النقدية (خروج): -1,000 د.ك
```

---

## أسئلة شائعة ❓

### س: هل يجب تفعيل الخيارين معاً؟
**ج:** نعم! إذا أردت خصم المبلغ من البنك فوراً:
- ✅ **إنشاء قيد محاسبي** (مفعّل افتراضياً)
- ✅ **تسجيل الدفع فوراً** (يجب تفعيله يدوياً)

### س: ماذا لو كانت المشتريات بالآجل؟
**ج:** فعّل فقط "إنشاء قيد محاسبي" واترك "تسجيل الدفع فوراً" **مُلغى**. سيتم تسجيل الدين على المورد وستدفع لاحقاً من القيود المحاسبية.

### س: كيف أدفع ديون المورد لاحقاً؟
**ج:** انتقل إلى **📝 القيود المحاسبية** وأنشئ قيد يدوي:
```
مدين: الموردون
دائن: البنك/الخزينة
```

### س: هل تظهر المشتريات في التقارير؟
**ج:** نعم! تظهر في:
- قائمة الدخل (تكلفة المشتريات)
- الميزانية العمومية (المخزون والبنك)
- قائمة التدفقات النقدية (إذا كان الدفع فورياً)

### س: كيف أتحقق من رصيد البنك/الخزينة؟
**ج:** افتح صفحة **🏦 الخزينة والبنوك** لرؤية:
- الرصيد الإجمالي
- رصيد كل حساب على حدة
- آخر المعاملات
- الأرصدة المتاحة

---

## ملاحظات مهمة 📌

1. **القيد التلقائي مفعّل افتراضياً** ✅
   - لا تلغي تفعيله إلا إذا كنت ستنشئ القيد يدوياً لاحقاً

2. **تسجيل الدفع الفوري اختياري** 💰
   - فعّله فقط إذا دفعت نقداً/بشيك/تحويل فوري
   - إذا لم تفعّله، سيبقى المبلغ ديناً على المورد

3. **اختيار الحساب البنكي إلزامي** 🏦
   - عند تفعيل "تسجيل الدفع فوراً"
   - اختر من: الخزينة (1001)، البنك (1002)، أو أي حساب نقدي آخر

4. **التقارير تلقائية** 📊
   - جميع القيود تظهر في التقارير تلقائياً
   - لا حاجة لإنشاء تقارير يدوية

---

## الخلاصة ✨

**لخصم فواتير المشتريات من البنك/الخزينة:**

```
✅ أنشئ فاتورة مشتريات
✅ فعّل "إنشاء قيد محاسبي" (مفعّل افتراضياً)
✅ فعّل "💰 تسجيل الدفع فوراً" ← **هذا المهم!**
✅ اختر الحساب البنكي/الخزينة
✅ احفظ الفاتورة

النتيجة:
✅ المخزون يزيد
✅ البنك/الخزينة ينقص ← **هذا ما تريده!**
✅ تظهر كل المعاملات في التقارير
```

---

## دعم فني 🛠️

إذا واجهت أي مشكلة:

1. **تأكد من تفعيل الخيارات الصحيحة** ✅
2. **تحقق من صفحة القيود المحاسبية** 📝
3. **راجع صفحة الخزينة والبنوك** 🏦
4. **افحص التقارير** 📊

**النظام يعمل بشكل صحيح!** فقط تأكد من تفعيل الخيار المناسب 💪

---

**تاريخ التحديث:** 25 أكتوبر 2025  
**الإصدار:** 2.0  
**الحالة:** ✅ جميع الميزات تعمل بشكل صحيح

# ุฅุตูุงุญ ููุทู ุงููุฑุชุฌุนุงุช ูุงูุฑุตูุฏ ุงูุงูุชุชุงุญู
## Purchase & Sales Returns + Opening Balance Payment Fix

ุชุงุฑูุฎ ุงูุฅุตูุงุญ: 1 ููููุจุฑ 2025

---

## ๐ ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

### 1๏ธโฃ ูุดููุฉ ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู ูู ุงูุณูุฏุงุช

**ุงููุดููุฉ:**
- ุนูุฏ ุณุฏุงุฏ 5 ุฏููุงุฑ ูู ุฑุตูุฏ ุงูุชุชุงุญู 10 ุฏููุงุฑุ ุงูุฑุตูุฏ ูุง ูุชุญุฏุซ ูู ุฌุฏูู ุงูุนููุงุก/ุงูููุฑุฏูู
- ุงูููุฏ ุงููุญุงุณุจู ูุชู ุฅูุดุงุคู ุจุดูู ุตุญูุญุ ููู ุงูุฑุตูุฏ ูู `customers`/`suppliers` table ูุง ูุชุญุฏุซ
- ุนูุฏ ูุชุญ ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ูุฑุฉ ุฃุฎุฑูุ ูุธูุฑ ุงูุฑุตูุฏ ุงููุงูู (10 ุฏููุงุฑ) ุจุฏูุงู ูู ุงููุชุจูู (5 ุฏููุงุฑ)

**ุงูุณุจุจ:**
- ุงูุณูุฏุงุช (`ReceiptVouchers.jsx` ู `PaymentVouchers.jsx`) ูุงูุช ุชููุดุฆ ุงูููุฏ ุงููุญุงุณุจู ููุท
- ูู ููู ููุงู ุชุญุฏูุซ ูู `customer.balance` ุฃู `supplier.balance` ูู ุฌุฏูู ุงูุจูุงูุงุช

**ุงูุญู:**
```javascript
// ูู ReceiptVouchers.jsx
if (!formData.invoiceId) {
  // ุฏูุน ูู ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู
  const customer = customers.find(c => c.id === formData.customerId)
  if (customer) {
    const newBalance = customer.balance - voucherAmount
    updateCustomer(customer.id, { balance: newBalance })
  }
}

// ูู PaymentVouchers.jsx  
if (!formData.invoiceId) {
  // ุฏูุน ูู ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู
  const supplier = suppliers.find(s => s.id === formData.supplierId)
  if (supplier) {
    const newBalance = supplier.balance + voucherAmount // ุงูููุฑุฏ ุฑุตูุฏู ุณุงูุจ
    updateSupplier(supplier.id, { balance: newBalance })
  }
}
```

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `src/components/ReceiptVouchers.jsx` (ุงูุณุทูุฑ 322-348)
- `src/components/PaymentVouchers.jsx` (ุงูุณุทูุฑ 324-350)

---

### 2๏ธโฃ ูุดููุฉ ููุทู ูุฑุชุฌุน ุงููุดุชุฑูุงุช

**ุงููุดููุฉ:**
```
ุนูุฏ ุฅูุดุงุก ูุฑุชุฌุน ูุดุชุฑูุงุช:
โ ูุชู ุฎุตู ุงููุจูุบ ูู ุงูุฎุฒููุฉ (ุตุญูุญ - ูุณุชุฑุฌุน ุงููุงู)
โ ูุชู ุฅุถุงูุฉ ุงููุจูุบ ููููุฑุฏ ูุฏุงุฆู ููุง (ุฎุทุฃ!)

ุงูููุทู ุงูุฎุงุทุฆ ุงูุณุงุจู:
- ูุฏูู: ุงููุดุชุฑูุงุช (ุนูุณ)
- ุฏุงุฆู: ุงูููุฑุฏ
- ุฏุงุฆู: ุงูุฎุฒููุฉ

ุงููุชูุฌุฉ ุงูุฎุงุทุฆุฉ: ุงูููุฑุฏ ูุตุจุญ ุฏุงุฆู ููุง ุจุงููุจูุบ ุงููุฑุชุฌุน!
```

**ุงูููุทู ุงูุตุญูุญ:**
```
ูุฑุชุฌุน ุงููุดุชุฑูุงุช ูุนูู:
1. ุฃุนุฏูุง ุงูุจุถุงุนุฉ ููููุฑุฏ
2. ุงุณุชุฑุฌุนูุง ุงููุงู ููู
3. ููููุต ูุฏููููุชูุง ูู

ุงูููุฏ ุงูุตุญูุญ:
- ูุฏูู: ุงูููุฑุฏ (ููููุต ูุฏููููุชูุง ูู)
- ูุฏูู: ุงูุฎุฒููุฉ (ูุณุชุฑุฌุน ุงููุงู)
- ุฏุงุฆู: ุงููุดุชุฑูุงุช (ุนูุณ ุงูููุฏ ุงูุฃุตูู)
- ุฏุงุฆู: ุงูุถุฑูุจุฉ (ุนูุณ ุงูููุฏ ุงูุฃุตูู)
```

**ุงูุญู ูู useAccounting.js:**
```javascript
if (isReturn) {
  // โ ุงูููุฑุฏ ูุตุจุญ ูุฏูู (ููููุต ูุฏููููุชูุง ูู)
  lines.push({
    accountId: supplierAccount.id,
    debit: total,
    credit: 0,
    description: `ูุฑุชุฌุน ูุดุชุฑูุงุช - ุชุฎููุถ ุฑุตูุฏ ุงูููุฑุฏ`
  })
  
  // โ ุงูุฎุฒููุฉ: ูุณุชุฑุฌุน ุงููุงู (ูุฏูู)
  lines.push({
    accountId: cashAccount.id,
    debit: total,
    credit: 0,
    description: `ุงุณุชุฑุฌุงุน ูุจูุบ ูุฑุชุฌุน ูุดุชุฑูุงุช`
  })
} else {
  // ูุงุชูุฑุฉ ุนุงุฏูุฉ
  lines.push({
    accountId: paymentAccount.id,
    debit: 0,
    credit: total,
    description: `ูุงุชูุฑุฉ ูุดุชุฑูุงุช`
  })
}
```

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `src/hooks/useAccounting.js` (ุงูุณุทูุฑ 990-1040)

---

### 3๏ธโฃ ูุดููุฉ ููุทู ูุฑุชุฌุน ุงููุจูุนุงุช

**ุงููุดููุฉ ุงูููุงุซูุฉ:**
```
ุนูุฏ ุฅูุดุงุก ูุฑุชุฌุน ูุจูุนุงุช:
โ ุงูููุทู ุงููุฏูู ูุงู ูุณุชุฎุฏู ููุณ ุงูุญุณุงุจ (customer ุฃู cash) ูู ููุง ุงูุญุงูุงุช
โ ูู ููู ูููุฑู ุจูู ุงููุฑุชุฌุน ูุงููุงุชูุฑุฉ ุงูุนุงุฏูุฉ ุจุดูู ุตุญูุญ
```

**ุงูููุทู ุงูุตุญูุญ:**
```
ูุฑุชุฌุน ุงููุจูุนุงุช ูุนูู:
1. ุงูุนููู ุฃุฑุฌุน ุงูุจุถุงุนุฉ ููุง
2. ุฑุฌุนูุง ูู ุงููุงู
3. ููููุต ูุฏููููุชู ููุง

ุงูููุฏ ุงูุตุญูุญ:
- ูุฏูู: ุงููุจูุนุงุช (ุนูุณ ุงูููุฏ ุงูุฃุตูู)
- ูุฏูู: ุงูุถุฑูุจุฉ (ุนูุณ ุงูููุฏ ุงูุฃุตูู)
- ุฏุงุฆู: ุงูุนููู (ููููุต ูุฏููููุชู ููุง)
- ุฏุงุฆู: ุงูุฎุฒููุฉ (ูุฑุฌุน ุงููุงู)
```

**ุงูุญู ูู useAccounting.js:**
```javascript
if (isReturn) {
  // โ ุงูุนููู ูุตุจุญ ุฏุงุฆู (ููููุต ูุฏููููุชู ููุง)
  lines.push({
    accountId: customerAccount.id,
    debit: 0,
    credit: total,
    description: `ูุฑุชุฌุน ูุจูุนุงุช - ุชุฎููุถ ุฑุตูุฏ ุงูุนููู`
  })
  
  // โ ุงูุฎุฒููุฉ: ูุฑุฌุน ุงููุงู (ุฏุงุฆู)
  lines.push({
    accountId: cashAccount.id,
    debit: 0,
    credit: total,
    description: `ุฅุฑุฌุงุน ูุจูุบ ูุฑุชุฌุน ูุจูุนุงุช`
  })
} else {
  // ูุงุชูุฑุฉ ุนุงุฏูุฉ
  lines.push({
    accountId: paymentAccount.id,
    debit: total,
    credit: 0,
    description: `ูุงุชูุฑุฉ ูุจูุนุงุช`
  })
}
```

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `src/hooks/useAccounting.js` (ุงูุณุทูุฑ 707-790)

---

## ๐งช ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุณุฏุงุฏ ุฌุฒุฆู ูู ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู

**ุงูุฎุทูุงุช:**
1. ุฅูุดุงุก ุนููู ุจุฑุตูุฏ ุงูุชุชุงุญู 10 ุฏููุงุฑ
2. ุฅูุดุงุก ุณูุฏ ูุจุถ ุจูุจูุบ 5 ุฏููุงุฑ (ุงุฎุชูุงุฑ "ุงูุฑุตูุฏ ุงูุงุจุชุฏุงุฆู")
3. ูุชุญ ูุงุฆูุฉ ุงูุณูุฏุงุช ูุฑุฉ ุฃุฎุฑู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุธูุฑ ุงูุฑุตูุฏ ุงููุชุจูู 5 ุฏููุงุฑ ููุท
- โ ูุง ูููู ุฅุฏุฎุงู ูุจูุบ ุฃูุซุฑ ูู 5 ุฏููุงุฑ
- โ ุงูููุฏ ุงููุญุงุณุจู ุตุญูุญ: ูุฏูู ุงูุฎุฒููุฉ / ุฏุงุฆู ุงูุนููุงุก

**ุงูููุฏ ุงููุณุคูู:**
```javascript
// ReceiptVouchers.jsx - lines 322-348
const newBalance = currentBalance - voucherAmount
updateCustomer(customer.id, { balance: newBalance })
```

---

### ุงุฎุชุจุงุฑ 2: ูุฑุชุฌุน ูุดุชุฑูุงุช

**ุงูุฎุทูุงุช:**
1. ุฅูุดุงุก ูุงุชูุฑุฉ ูุดุชุฑูุงุช ูุฏููุนุฉ ุจูุจูุบ 100 ุฏููุงุฑ
2. ุฅูุดุงุก ูุฑุชุฌุน ูููุงุชูุฑุฉ ุจูุจูุบ 30 ุฏููุงุฑ
3. ูุญุต ุงูููุฏ ุงููุญุงุณุจู ูุงูุฃุฑุตุฏุฉ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
ุงูููุฏ ุงููุญุงุณุจู ูููุฑุชุฌุน:
- ูุฏูู: ุงูููุฑุฏูู (30)       โ ููููุต ูุฏููููุชูุง ูู
- ูุฏูู: ุงูุฎุฒููุฉ (30)         โ ูุณุชุฑุฌุน ุงููุงู
- ุฏุงุฆู: ุงููุดุชุฑูุงุช (30)       โ ุนูุณ ุงูููุฏ
- ุฏุงุฆู: ุงูุถุฑูุจุฉ (ุฅู ูุฌุฏุช)

ุงูุฃุฑุตุฏุฉ:
- ุฑุตูุฏ ุงูุฎุฒููุฉ: +30 ุฏููุงุฑ โ
- ุฑุตูุฏ ุงูููุฑุฏ: ุชุฎููุถ 30 ุฏููุงุฑ (ุฃูู ูุฏููููุฉ) โ
- ุฑุตูุฏ ุงููุดุชุฑูุงุช: ุชุฎููุถ 30 ุฏููุงุฑ โ
```

**ุงูููุฏ ุงููุณุคูู:**
```javascript
// useAccounting.js - lines 990-1040
if (isReturn) {
  lines.push({ accountId: supplierAccount.id, debit: total, credit: 0 })
  lines.push({ accountId: cashAccount.id, debit: total, credit: 0 })
}
```

---

### ุงุฎุชุจุงุฑ 3: ูุฑุชุฌุน ูุจูุนุงุช

**ุงูุฎุทูุงุช:**
1. ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช ูุฏููุนุฉ ุจูุจูุบ 150 ุฏููุงุฑ
2. ุฅูุดุงุก ูุฑุชุฌุน ูููุงุชูุฑุฉ ุจูุจูุบ 50 ุฏููุงุฑ
3. ูุญุต ุงูููุฏ ุงููุญุงุณุจู ูุงูุฃุฑุตุฏุฉ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
ุงูููุฏ ุงููุญุงุณุจู ูููุฑุชุฌุน:
- ูุฏูู: ุงููุจูุนุงุช (50)        โ ุนูุณ ุงูููุฏ
- ูุฏูู: ุงูุถุฑูุจุฉ (ุฅู ูุฌุฏุช)
- ุฏุงุฆู: ุงูุนููุงุก (50)         โ ููููุต ูุฏููููุฉ ุงูุนููู
- ุฏุงุฆู: ุงูุฎุฒููุฉ (50)         โ ูุฑุฌุน ุงููุงู

ุงูุฃุฑุตุฏุฉ:
- ุฑุตูุฏ ุงูุฎุฒููุฉ: -50 ุฏููุงุฑ โ
- ุฑุตูุฏ ุงูุนููู: ุชุฎููุถ 50 ุฏููุงุฑ (ุฃูู ูุฏููููุฉ) โ
- ุฑุตูุฏ ุงููุจูุนุงุช: ุชุฎููุถ 50 ุฏููุงุฑ โ
```

**ุงูููุฏ ุงููุณุคูู:**
```javascript
// useAccounting.js - lines 707-790
if (isReturn) {
  lines.push({ accountId: customerAccount.id, debit: 0, credit: total })
  lines.push({ accountId: cashAccount.id, debit: 0, credit: total })
}
```

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

| ุงูููู | ุงูุณุทูุฑ ุงููุนุฏูุฉ | ุงููุตู |
|------|----------------|-------|
| `useAccounting.js` | 707-790 | ุฅุตูุงุญ ููุทู ูุฑุชุฌุน ุงููุจูุนุงุช |
| `useAccounting.js` | 990-1040 | ุฅุตูุงุญ ููุทู ูุฑุชุฌุน ุงููุดุชุฑูุงุช |
| `ReceiptVouchers.jsx` | 10-18, 322-348 | ุฅุถุงูุฉ updateCustomer ูุชุญุฏูุซ ุงูุฑุตูุฏ |
| `PaymentVouchers.jsx` | 10-18, 324-350 | ุฅุถุงูุฉ updateSupplier ูุชุญุฏูุซ ุงูุฑุตูุฏ |

---

## ๐ฏ ุงูููุงุฆุฏ

1. **ุฏูุฉ ูุญุงุณุจูุฉ ุฃูุถู:** ุงููููุฏ ุงููุญุงุณุจูุฉ ูููุฑุชุฌุนุงุช ุฃุตุจุญุช ุตุญูุญุฉ 100%
2. **ุชุชุจุน ุงูุฃุฑุตุฏุฉ:** ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู ูุชุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ุงูุณุฏุงุฏ ุงูุฌุฒุฆู
3. **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ:** ุงููุณุชุฎุฏู ูุฑู ุงูุฑุตูุฏ ุงูุตุญูุญ ุงููุชุจูู
4. **ููุน ุงูุฃุฎุทุงุก:** ูุง ูููู ุฏูุน ุฃูุซุฑ ูู ุงูุฑุตูุฏ ุงููุชุจูู

---

## ๐ ููุงุญุธุงุช ูููุฉ

### ูููุญุงุณุจูู:
- **ูุฑุชุฌุน ุงููุดุชุฑูุงุช:** ุฏุงุฆูุงู ููููุต ูุฏููููุชูุง ููููุฑุฏ (ุงูููุฑุฏ ูุฏูู)
- **ูุฑุชุฌุน ุงููุจูุนุงุช:** ุฏุงุฆูุงู ููููุต ูุฏููููุฉ ุงูุนููู ููุง (ุงูุนููู ุฏุงุฆู)
- **ุงูุฎุฒููุฉ ูู ุงููุฑุชุฌุนุงุช:** ุฏุงุฆูุงู ุชุชุฃุซุฑ (ูุณุชุฑุฌุน ุฃู ูุฑุฌุน ุงููุงู)

### ูููุทูุฑูู:
- ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู ููุญุฏุซ ูู ุฌุฏูููู: `customers`/`suppliers` **ู** ุงููููุฏ ุงููุญุงุณุจูุฉ
- `updateCustomer` ู `updateSupplier` ููุญุฏุซุงู ุงูู React state ุชููุงุฆูุงู ุนุจุฑ `setCustomers`/`setSuppliers`
- ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ุชูุฑุฃ ูู ุงูู state ุงููุญุฏุซ ูุจุงุดุฑุฉ

---

## โ ุงูุญุงูุฉ ุงูููุงุฆูุฉ

ุฌููุน ุงููุดุงูู ุชู ุฅุตูุงุญูุง ุจูุฌุงุญ:
- โ ุงูุฑุตูุฏ ุงูุงูุชุชุงุญู ูุชุญุฏุซ ุนูุฏ ุงูุฏูุน ุงูุฌุฒุฆู
- โ ูุฑุชุฌุน ุงููุดุชุฑูุงุช: ุงูููุฏ ุงููุญุงุณุจู ุตุญูุญ (ุงูููุฑุฏ ูุฏูู)
- โ ูุฑุชุฌุน ุงููุจูุนุงุช: ุงูููุฏ ุงููุญุงุณุจู ุตุญูุญ (ุงูุนููู ุฏุงุฆู)
- โ ุงูุฎุฒููุฉ ุชุชุฃุซุฑ ุจุดูู ุตุญูุญ ูู ุฌููุน ุงูุญุงูุงุช
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู ุงูููุฏ (ESLint pass)

---

**ุชู ุงูุชูุซูู ุจูุงุณุทุฉ:** GitHub Copilot  
**ุชุงุฑูุฎ:** 1 ููููุจุฑ 2025

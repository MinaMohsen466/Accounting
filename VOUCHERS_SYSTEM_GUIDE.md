# 📄 نظام السندات المحاسبية - دليل المستخدم الشامل

## 🎯 نظرة عامة

تم إنشاء نظام متكامل لإدارة **سندات القبض والدفع** بشكل محاسبي دقيق، مع قفل **الرصيد الافتتاحي** بعد أول معاملة.

---

## 📋 المفاهيم الأساسية

### 1. الرصيد الافتتاحي (Opening Balance)
- **التعريف**: المبلغ الذي يبدأ به العميل أو المورد قبل استخدام النظام
- **الإدخال**: مرة واحدة فقط عند إضافة العميل أو المورد
- **القفل**: بعد بدء التعاملات (فواتير أو سندات)، يتم قفل هذا الحقل تلقائياً
- **السبب**: للحفاظ على دقة السجلات المحاسبية ومنع التلاعب

### 2. السندات (Vouchers)

#### سند القبض (Receipt Voucher)
- **الاستخدام**: عندما يدفع العميل مبلغاً نقداً أو بأي وسيلة أخرى
- **التأثير المحاسبي**:
  ```
  من ح/ الخزينة (أو البنك)    [مدين]
  إلى ح/ العملاء               [دائن]
  ```
- **التأثير على الرصيد**: يقلل من رصيد العميل المدين لنا

#### سند الدفع (Payment Voucher)
- **الاستخدام**: عندما ندفع مبلغاً لمورد
- **التأثير المحاسبي**:
  ```
  من ح/ الموردون              [مدين]
  إلى ح/ الخزينة (أو البنك)   [دائن]
  ```
- **التأثير على الرصيد**: يقلل من رصيد المورد الذي ندين له

---

## 🔧 الملفات المُنشأة والمُحدَّثة

### 1. ملفات جديدة (New Files)
- ✅ `src/components/ReceiptVouchers.jsx` - مكون سندات القبض
- ✅ `src/components/PaymentVouchers.jsx` - مكون سندات الدفع
- ✅ `src/components/Vouchers.css` - تنسيقات السندات
- ✅ `VOUCHERS_SYSTEM_GUIDE.md` - هذا الملف

### 2. ملفات محدَّثة (Updated Files)
- ✅ `src/services/DataService.js`
  - إضافة `VOUCHERS` إلى `STORAGE_KEYS`
  - دوال: `getVouchers()`, `addVoucher()`, `updateVoucher()`, `deleteVoucher()`, `generateVoucherNumber()`
  
- ✅ `src/hooks/useAccounting.js`
  - إضافة `vouchers` state
  - إضافة دوال: `addVoucher()`, `updateVoucher()`, `deleteVoucher()`
  - إضافة دالة: `hasTransactions()` للتحقق من وجود معاملات
  - تحديث `getCustomerSupplierStatement()` لتضمين السندات
  
- ✅ `src/App.jsx`
  - استيراد مكونات السندات
  - إضافة حالات جديدة في `renderContent()`
  
- ✅ `src/components/Sidebar.jsx`
  - إضافة قسم "السندات" مع قائمة فرعية (سندات القبض، سندات الدفع)
  
- ✅ `src/components/Sidebar.css`
  - تنسيقات القائمة الفرعية (submenu)
  
- ✅ `src/contexts/AuthContext.jsx`
  - إضافة صلاحيات: `manage_vouchers`, `create_vouchers`, `delete_vouchers`
  
- ✅ `src/components/CustomersSuppliers.jsx`
  - قفل حقل `openingBalance` بعد أول معاملة
  - عرض رسالة تحذيرية عند محاولة التعديل
  - تحديث حساب الرصيد ليشمل السندات

---

## 💡 كيفية الاستخدام

### 1. إضافة عميل أو مورد جديد
1. اذهب إلى **العملاء والموردين**
2. اضغط على **إضافة عميل** أو **إضافة مورد**
3. أدخل البيانات الأساسية
4. **الرصيد الافتتاحي**: أدخل الرصيد الحالي (إن وجد)
   - موجب (+): العميل/المورد مدين لنا
   - سالب (-): نحن مدينون للعميل/المورد
5. احفظ

⚠️ **ملاحظة**: بعد أول فاتورة أو سند، لن تتمكن من تعديل الرصيد الافتتاحي

### 2. إنشاء سند قبض (من عميل)
1. اذهب إلى **السندات > سندات القبض**
2. اضغط على **سند قبض جديد**
3. املأ البيانات:
   - العميل
   - المبلغ
   - الحساب (خزينة أو بنك)
   - طريقة الدفع (نقدي، بنك، شيك)
   - التاريخ
   - المرجع (رقم شيك أو تحويل)
   - البيان
4. احفظ

**النتيجة المحاسبية**:
- زيادة رصيد الخزينة/البنك ✅
- تقليل رصيد العميل المدين ✅
- إنشاء قيد محاسبي تلقائي ✅

### 3. إنشاء سند دفع (لمورد)
1. اذهب إلى **السندات > سندات الدفع**
2. اضغط على **سند دفع جديد**
3. املأ البيانات:
   - المورد
   - المبلغ
   - الحساب (خزينة أو بنك)
   - طريقة الدفع
   - التاريخ
   - المرجع
   - البيان
4. احفظ

**النتيجة المحاسبية**:
- تقليل رصيد الخزينة/البنك ✅
- تقليل رصيد المورد الدائن ✅
- إنشاء قيد محاسبي تلقائي ✅

---

## 📊 حساب الرصيد الديناميكي

### المعادلة الأساسية
```
الرصيد الكلي = الرصيد الافتتاحي + إجمالي الفواتير - إجمالي المدفوعات (السندات)
```

### للعميل
```
رصيد العميل = الرصيد الافتتاحي + فواتير المبيعات - سندات القبض
```

### للمورد
```
رصيد المورد = الرصيد الافتتاحي + فواتير المشتريات - سندات الدفع
```

---

## 🔐 الصلاحيات المطلوبة

| العملية | الصلاحية المطلوبة |
|---------|-------------------|
| عرض السندات | `manage_vouchers` |
| إنشاء سند جديد | `create_vouchers` |
| حذف سند | `delete_vouchers` |

---

## 🎨 واجهة المستخدم

### سندات القبض
- أيقونة: 🧾
- لون: أخضر/أزرق
- الموقع: **السندات > سندات القبض**

### سندات الدفع
- أيقونة: 💸
- لون: أحمر/برتقالي
- الموقع: **السندات > سندات الدفع**

---

## 📈 التقارير والكشوفات

### كشف حساب العميل/المورد
عند فتح كشف حساب لعميل أو مورد، سترى:

1. **الرصيد الافتتاحي** (Opening Balance)
2. **المعاملات** (Transactions):
   - فواتير المبيعات/المشتريات
   - **سندات القبض/الدفع** 🆕
3. **إجمالي المدين** (Total Debit)
4. **إجمالي الدائن** (Total Credit)
5. **الرصيد الختامي** (Closing Balance)

---

## 🧪 اختبار النظام

### سيناريو 1: عميل جديد
1. إضافة عميل برصيد افتتاحي: 100 دينار
2. إصدار فاتورة مبيعات: 50 دينار
3. الرصيد الحالي: **150 دينار** (العميل مدين لنا)
4. استلام سند قبض: 80 دينار
5. الرصيد النهائي: **70 دينار** (100 + 50 - 80)

### سيناريو 2: مورد جديد
1. إضافة مورد برصيد افتتاحي: 0 دينار
2. إصدار فاتورة مشتريات: 200 دينار
3. الرصيد الحالي: **200 دينار** (نحن مدينون له)
4. دفع سند: 100 دينار
5. الرصيد النهائي: **100 دينار** (0 + 200 - 100)

---

## ⚠️ ملاحظات مهمة

### 1. قفل الرصيد الافتتاحي
- بعد أول فاتورة أو سند، يتم قفل حقل الرصيد الافتتاحي تلقائياً
- يظهر تحذير: **"⚠️ الرصيد الافتتاحي مقفل بعد إجراء معاملات"**
- **لا يمكن** تعديل الرصيد الافتتاحي من شاشة العملاء/الموردين
- **الحل**: استخدم سند قبض أو سند دفع لتعديل الرصيد

### 2. القيود المحاسبية التلقائية
- كل سند ينشئ قيد محاسبي تلقائياً
- القيد يحدث فوراً على أرصدة الحسابات
- يمكن مراجعة القيود من شاشة **القيود اليومية**

### 3. حذف السندات
- عند حذف سند، يجب أيضاً حذف القيد المحاسبي المرتبط
- **تحذير**: حذف سند قد يؤثر على أرصدة الحسابات

---

## 🔄 التكامل مع الأنظمة الأخرى

### مع نظام الفواتير
- عند إنشاء فاتورة، يزداد رصيد العميل/المورد
- عند الدفع الفوري، لا يؤثر على الرصيد (دفع مباشر)
- عند الدفع الآجل، يزداد الرصيد المدين/الدائن

### مع نظام المحاسبة
- كل سند ينشئ قيد محاسبي
- القيود تظهر في كشف الحساب
- الأرصدة تحدَّث فوراً

### مع نظام التقارير
- كشف حساب العميل/المورد يتضمن السندات
- الميزانية تعكس حركة الخزينة والبنوك
- قائمة الدخل تتأثر بالمدفوعات والمقبوضات

---

## 🛠️ التطويرات المستقبلية المقترحة

1. ✨ **طباعة السندات**
   - تصميم نموذج طباعة لسند القبض
   - تصميم نموذج طباعة لسند الدفع
   
2. ✨ **ربط السندات بالفواتير**
   - تحديد فاتورة معينة عند إنشاء سند
   - تحديث حالة الفاتورة تلقائياً (مدفوع/جزئي)
   
3. ✨ **تقارير السندات**
   - تقرير سندات القبض (يومي، شهري)
   - تقرير سندات الدفع (يومي، شهري)
   - تقرير التدفقات النقدية
   
4. ✨ **موافقات السندات**
   - نظام موافقات متعدد المستويات
   - سندات معلقة / مرفوضة / موافق عليها
   
5. ✨ **السندات المتكررة**
   - سندات دورية (شهرية، ربع سنوية)
   - إنشاء تلقائي للسندات المتكررة

---

## 📞 الدعم والمساعدة

إذا واجهت أي مشكلة:
1. تحقق من الصلاحيات
2. راجع القيود المحاسبية المنشأة
3. تأكد من اختيار الحساب الصحيح (خزينة أو بنك)
4. تحقق من تاريخ السند

---

## 📝 ملخص سريع

| العنصر | الوصف |
|--------|-------|
| **الرصيد الافتتاحي** | يُدخل مرة واحدة ويُقفل بعد أول معاملة |
| **سند القبض** | استلام مبلغ من عميل → يقلل رصيد العميل |
| **سند الدفع** | دفع مبلغ لمورد → يقلل رصيد المورد |
| **القيود** | تُنشأ تلقائياً مع كل سند |
| **الرصيد الكلي** | افتتاحي + فواتير - سندات |

---

**تم بناء النظام بدقة محاسبية عالية ✅**

**جاهز للاستخدام الفوري! 🚀**
